# Quick Start Guide: Testing Section 4.3.2 Implementation

## Prerequisites

1. **Database**: PostgreSQL running with migrations applied
2. **Server**: Symfony development server running
3. **Test Data**: Project fixtures loaded (recommended)

## Step 1: Ensure Database is Ready

```bash
# Check database connection
bin/console doctrine:database:create --if-not-exists

# Apply migrations (including currentProgress field)
bin/console doctrine:migrations:migrate --no-interaction

# Load test data (optional but recommended)
bin/console doctrine:fixtures:load --no-interaction
```

## Step 2: Start Development Server

```bash
# Option 1: Symfony CLI (recommended)
symfony serve

# Option 2: PHP built-in server
php -S localhost:8000 -t public/
```

## Step 3: Access Project Homepage

Open your browser and navigate to:

```
http://localhost:8000/
```

or (if using Symfony serve):

```
https://127.0.0.1:8000/
```

## What You Should See

### 1. Statistics Widgets (Top Section)

Four colored cards showing:
- **项目总数** (Total Projects) - Blue
- **进行中** (In Progress) - Green
- **已闭环** (Closed) - Cyan
- **已终止** (Terminated) - Red

Below that, a lifecycle stage distribution bar showing 7 stages with icons.

### 2. Filter Section

A white card with:
- 4 dropdown filters (Stage, Status, Nature, Sort)
- 1 search input field
- "搜索" (Search) and "重置" (Reset) buttons

### 3. Quick Action Button

A large blue button:
```
[+ 新增项目登记]
```

### 4. Project Cards Grid

3 columns (desktop) of project cards, each showing:
- Project number and status badge
- Project name (clickable)
- Project type and nature
- Current stage badge
- Progress bars (overall + construction if applicable)
- Personnel info with masked phone
- Budget, timeline, location
- Action buttons at bottom

## Testing Scenarios

### Scenario 1: View All Projects

**Steps:**
1. Load homepage (no filters)
2. Verify all projects are displayed
3. Check statistics match the card count

**Expected Result:**
- All registered projects visible
- Statistics accurate
- Cards display properly

### Scenario 2: Filter by Lifecycle Stage

**Steps:**
1. Select "施工实施中" from 流程阶段 dropdown
2. Click "搜索"

**Expected Result:**
- Only projects with ConstructionImplementation records shown
- Construction progress bar visible on filtered cards
- Statistics updated

### Scenario 3: Search by Project Number

**Steps:**
1. Enter exact project number in search field (e.g., "XM2024001")
2. Click "搜索"

**Expected Result:**
- Single project card displayed (exact match)
- All project details correct

### Scenario 4: Fuzzy Search by Name

**Steps:**
1. Enter partial project name (e.g., "智慧城市")
2. Click "搜索"

**Expected Result:**
- All projects with matching name fragment displayed
- Search is case-insensitive

### Scenario 5: Sort by Budget

**Steps:**
1. Select "预算" from 排序方式 dropdown
2. Select "倒序" (descending)
3. Click "搜索"

**Expected Result:**
- Projects displayed from highest to lowest budget
- Budget formatting correct (X,XXX.XX 万元)

### Scenario 6: View Project Details

**Steps:**
1. Click project name or "查看详情" button on any card
2. Verify redirect to EasyAdmin detail page

**Expected Result:**
- Redirect to `/admin?crudAction=detail&crudControllerFqcn=App\Controller\Admin\ProjectCrudController&entityId=X`
- Full project details displayed

### Scenario 7: Create New Project

**Steps:**
1. Click "新增项目登记" button at top
2. Verify redirect to new project form

**Expected Result:**
- Redirect to `/admin?crudAction=new&crudControllerFqcn=App\Controller\Admin\ProjectCrudController`
- Project creation form displayed

### Scenario 8: Phone Number Privacy

**Steps:**
1. View any project card
2. Check 负责人 phone number display

**Expected Result:**
- Phone displayed as: `138****5678` (first 3 + last 4 digits visible)

### Scenario 9: Progress Bar Visualization

**Steps:**
1. Find a project in 施工实施 stage with currentProgress set
2. Verify two progress bars displayed

**Expected Result:**
- **整体进度** bar: Based on lifecycle stage (0-100%)
- **施工进度** bar: Based on currentProgress field (0-100%)
- Color coding: Red (<30%), Yellow (30-69%), Green (≥70%)

### Scenario 10: Closed Project State

**Steps:**
1. Find a project with status "已完成" or "已取消"
2. Check card footer buttons

**Expected Result:**
- "编辑" button replaced with "已闭环" badge (green)
- "查看详情" button still available

## Verification Checklist

Use this checklist to verify complete implementation:

### Display Fields (4.3.2.1)
- [ ] Project number displayed
- [ ] Project name displayed (clickable)
- [ ] Project type/subtype displayed
- [ ] Project nature badge displayed
- [ ] Current stage label displayed
- [ ] Progress percentage displayed (if applicable)
- [ ] Overall progress bar displayed
- [ ] Status badge displayed with correct color
- [ ] Leader name displayed
- [ ] Leader phone masked correctly (138****5678)
- [ ] Registrant name displayed
- [ ] Budget formatted in 万元 with commas
- [ ] Planned timeline formatted (YYYY-MM-DD ~ YYYY-MM-DD)
- [ ] Location displayed
- [ ] Funding source displayed
- [ ] Contractor name displayed (if available)
- [ ] Acceptance result displayed (if available)
- [ ] Created timestamp displayed
- [ ] Updated timestamp displayed

### Filters (4.3.2.2)
- [ ] Lifecycle stage filter works (9 options)
- [ ] Project status filter works (7 options)
- [ ] Project nature filter works (2 options)
- [ ] Search by exact project number works
- [ ] Fuzzy search by project name works
- [ ] Fuzzy search by leader name works
- [ ] Fuzzy search by registrant name works
- [ ] Sort by updatedAt works (default)
- [ ] Sort by createdAt works
- [ ] Sort by projectName works
- [ ] Sort by budget works
- [ ] ASC/DESC toggle works
- [ ] Reset button clears all filters

### Statistics (4.3.2.3)
- [ ] Total projects count correct
- [ ] In-progress count correct
- [ ] Closed count correct
- [ ] Terminated count correct
- [ ] Preliminary decision stage count correct
- [ ] Approval stage count correct
- [ ] Planning stage count correct
- [ ] Preparation stage count correct
- [ ] Implementation stage count correct
- [ ] Acceptance stage count correct
- [ ] Settlement stage count correct

### Actions
- [ ] "新增项目登记" redirects correctly
- [ ] "查看详情" redirects correctly
- [ ] "编辑" redirects correctly (non-closed projects)
- [ ] Closed projects show "已闭环" instead of "编辑"
- [ ] Click on project name opens detail page

### Visual/UX
- [ ] Cards have hover effect (lift + shadow)
- [ ] Status badges have correct colors
- [ ] Progress bars have correct colors
- [ ] Icons display correctly (Font Awesome)
- [ ] Layout is responsive (test at 1920px, 1024px, 768px, 375px)
- [ ] Statistics cards display in correct colors

## Troubleshooting

### Problem: Homepage shows 404

**Solution:**
```bash
# Clear cache
bin/console cache:clear

# Check routes
bin/console debug:router | grep project_homepage
```

### Problem: No projects displayed

**Solution:**
```bash
# Load fixtures
bin/console doctrine:fixtures:load --no-interaction

# Verify data exists
bin/console dbal:run-sql "SELECT COUNT(*) FROM project"
```

### Problem: Progress bar not showing

**Solution:**
```bash
# Check if currentProgress field exists
bin/console dbal:run-sql "SELECT column_name FROM information_schema.columns WHERE table_name='construction_implementation' AND column_name='current_progress'"

# If missing, run migration
bin/console doctrine:migrations:migrate
```

### Problem: Styles not loading

**Solution:**
- Check that Bootstrap CDN is accessible
- Check browser console for 404 errors
- Clear browser cache (Ctrl+Shift+R)

### Problem: Icons not showing

**Solution:**
- Check that Font Awesome CDN is accessible
- Verify icon class names (fa-solid, fa-regular, etc.)
- Check browser console for errors

## Sample Data for Testing

If you want to manually create test data with currentProgress:

```php
// In EasyAdmin, create a ConstructionImplementation record:
// - Project: (select any project)
// - Start Date: 2026-01-01
// - Completion Date: 2026-12-31
// - 当前实施进度（%）: 65  ← NEW FIELD
// - Construction Progress Details: (fill with text)
```

## Performance Testing

### Test with Large Dataset

```bash
# Create 100 projects (requires custom fixture)
# Expected: Page loads in < 2 seconds
# Cards display without lag
```

### Test Filter Performance

```bash
# Apply multiple filters simultaneously
# Expected: Results update in < 1 second
```

## Next Steps After Verification

Once you've verified the implementation:

1. **Add Pagination**: For better performance with large datasets
2. **Implement Role-Based Filtering**: Filter projects based on user role (4.3.4)
3. **Add Anomaly Alerts**: Implement 异常提醒聚合 (4.3.1 Point 7)
4. **Ajax Filtering**: Update without page reload
5. **Export Functionality**: Export filtered results to Excel/PDF

## Support

For issues or questions:
- Check implementation docs: `docs/implementation_4.3.2.md`
- Review visual reference: `docs/4.3.2_visual_reference.md`
- Consult design document: `docs/src/design.md` section 4.3.2
